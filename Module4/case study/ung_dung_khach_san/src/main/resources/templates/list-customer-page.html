<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <th:block th:replace="~{home-page :: css}"></th:block>
    <style>
        #header {
            position: relative;
        }

        #footer {
            position: sticky;
            margin-top: 10%;
            background: #2c3e50;
        }
    </style>
</head>
<body style="background-color: #EFFFFD">
<th:block th:insert="~{layout :: header}"></th:block>

<main class="container">
    <div style="padding: 30px">
        <h1 style="color: #4E944F" class="text-center">Customer Management</h1>
    </div>
    <nav class="navbar justify-content-between container-fluid">

        <div>
            <button type="button" class="btn btn-success" id="addNew" data-toggle="modal"
                    data-target="#addNewCustomerModal">Add New Customer
            </button>
            <!-- Add new customer Modal -->
            <form th:object="${customerObj}" action="/customer/add" method="post">
                <!--            <input type="hidden" th:field="*{id}">-->
                <div class="modal fade" id="addNewCustomerModal">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="text-center">
                                <h3 class="modal-title" style="color: #4E944F; padding-top: 10px">Add new customer</h3>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                <table class="table table-hover">
                                    <tr>
                                        <th>Name</th>
                                        <td>
                                            <input th:field="*{name}" class="form-control">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Date of Birth</th>
                                        <td>
                                            <input th:field="*{dateOfBirth}" type="date" class="form-control">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Id Card</th>
                                        <td>
                                            <input th:field="*{idCard}" class="form-control">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Phone Number</th>
                                        <td>
                                            <input th:field="*{phoneNumber}" class="form-control">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Address</th>
                                        <td>
                                            <input th:field="*{address}" class="form-control">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Email</th>
                                        <td>
                                            <input th:field="*{email}" class="form-control">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Gender</th>
                                        <td>
                                            <select th:field="*{gender}" class="form-select">
                                                <option th:each="genderObj :${genderList}" th:value="${genderObj.id}"
                                                        th:text="${genderObj.name}"></option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Customer Type</th>
                                        <td>
                                            <select th:field="*{customerType}" class="form-select">
                                                <option th:each="customerTypeObj :${customerTypeList}"
                                                        th:value="${customerTypeObj.id}"
                                                        th:text="${customerTypeObj.name}"></option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-danger">Submit Add</button>
                            </div>

                        </div>
                    </div>
                </div>
            </form>
            <!-- End "Add new customer Modal"-->
        </div>

        <div></div>
        <form action="/customer/list" style="padding: 15px">
            <table>
                <tr>
                    <td>
                        <input name="searchByNameCustomer" th:value="${nameSearchVal}" class="form-control mr-sm-2">
                    </td>
                    <td>
                        <button type="submit" class="btn btn-success">
                            Search
                        </button>
                    </td>
                </tr>
            </table>
        </form>
    </nav>

<div style="overflow-x:auto;">
    <table class="table table-bordered table-sm" style="color: #041C32
    ; border-color: #CEE5D0;box-shadow: 5px 10px 18px #ADCF9F; white-space: nowrap">
        <thead>
        <tr style="background: #A3DA8D; color: #041C32">
            <th>STT</th>
            <th>Name</th>
            <th>Date of birth</th>
            <th>Id Card</th>
            <th>Phone Number</th>
            <th>Email</th>
            <th>Address</th>
            <th>Gender</th>
            <th>Customer Type</th>
            <th colspan="2" class="text-center">Action</th>
        </tr>
        </thead>
        <tr th:each="customer,loop :${customerPage}">
            <!--            <td th:text="${customer.id}"></td>-->
            <td th:text="${loop.count + customerPage.number * customerPage.size}"></td>
            <td th:text="${customer.name}"></td>
            <td th:text="${customer.dateOfBirth}"></td>
            <td th:text="${customer.idCard}"></td>
            <td th:text="${customer.phoneNumber}"></td>
            <td th:text="${customer.email}"></td>
            <td th:text="${customer.address}"></td>
            <td th:text="${customer.gender.name}"></td>
            <td th:text="${customer.customerType.name}"></td>
            <td>
                <button class="btn btn-outline-success" data-toggle="modal"
                        th:data-target="'#editCustomerModal'+${customer.id}">
                    Edit
                </button>
                <!-- Edit customer Modal -->

                <div class="modal fade" th:id="'editCustomerModal'+${customer.id}">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title" style="color: #4E944F">Edit Customer</h4>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                <table class="table table-hover">
                                    <input type="hidden" th:value="${customer.id}" th:id="'customerId'+${customer.id}">
                                    <tr>
                                        <th>Name</th>
                                        <td>
                                            <input class="form-control" th:value="${customer.name}"
                                                   th:id="'customerName'+${customer.id}">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Date of Birth</th>
                                        <td>
                                            <input class="form-control" th:value="${customer.dateOfBirth}"
                                                   th:id="'customerDateOfBirth'+${customer.id}">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Id Card</th>
                                        <td>
                                            <input class="form-control" th:value="${customer.idCard}"
                                                   th:id="'customerIdCard'+${customer.id}">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Phone Number</th>
                                        <td>
                                            <input class="form-control" th:value="${customer.phoneNumber}"
                                                   th:id="'customerPhoneNumber'+${customer.id}">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Email</th>
                                        <td>
                                            <input class="form-control" th:value="${customer.email}"
                                                   th:id="'customerEmail'+${customer.id}">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Address</th>
                                        <td>
                                            <input class="form-control" th:value="${customer.address}"
                                                   th:id="'customerAddress'+${customer.id}">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Gender</th>
                                        <td>
                                            <select class="form-select" th:id="'customerGender'+${customer.id}">
                                                <option th:each="gender :${genderList}"
                                                        th:value="${gender.id}" th:text="${gender.name}"
                                                        th:if="${gender.id == customer.gender.id}" selected>
                                                </option>
                                                <option th:each="gender :${genderList}"
                                                        th:value="${gender.id}" th:text="${gender.name}">
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Customer Type</th>
                                        <td>
                                            <select class="form-select" th:id="'customerCustomerType'+${customer.id}">
                                                <option th:each="customerType :${customerTypeList}"
                                                        th:value="${customerType.id}" th:text="${customerType.name}"
                                                        th:if="${customerType.id == customer.customerType.id}" selected>
                                                </option>
                                                <option th:each="customerType :${customerTypeList}"
                                                        th:value="${customerType.id}" th:text="${customerType.name}">
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-danger"
                                        th:onclick="'dataForEditForm('+${customer.id}+')'">Submit Edit
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
                </form>
            </td>
            <td>
                <!-- Button Open delete Modal -->
                <button class="btn btn-outline-danger" data-toggle="modal"
                        th:data-target="'#deleteModal'+${customer.id}">
                    Delete
                </button>


                <!-- The delete Modal -->
                <div class="modal fade" th:id="'deleteModal'+${customer.id}" style="color: crimson">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title" style="color: #4E944F">Delete <span
                                        th:text="${customer.name}"></span></h4>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                Bạn có chắc chắn muốn xóa không?
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-dismiss="modal">No</button>
                                <form th:action="@{/customer/delete/{id}(id=${customer.id})}" method="post">
                                    <button type="submit" class="btn btn-danger">Yes</button>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </table>

    <div class="row text-center">
        <p1 th:text="${pageEmpty}" style="color: crimson"></p1>
    </div>

    <!--paging-->
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-end">
            <li class="page-item">
                <a class="page-link" th:if="${customerPage.hasPrevious()}"
                   th:href="@{/customer/list(page=${customerPage.number - 1})}">Previous</a>
            </li>
            <li class="page-item"><a class="page-link" th:if="${customerPage.hasPrevious()}"
                                     th:href="@{/customer/list(page=${customerPage.number - 1})}"
                                     th:text="${customerPage.number}"></a></li>
            <li class="page-item"><span class="page-link" th:text="${customerPage.number + 1}"></span></li>
            <li class="page-item"><a class="page-link" th:if="${customerPage.hasNext()}"
                                     th:href="@{/customer/list(page=${customerPage.number + 1})}"
                                     th:text="${customerPage.number + 2}"></a></li>
            <li class="page-item">
                <a class="page-link" th:if="${customerPage.hasNext()}"
                   th:href="@{/customer/list(page=${customerPage.number + 1})}">Next</a>
            </li>
        </ul>
    </nav>
</div>
</main>

<!-- mess Modal -->
<div th:if="${mess!=null}" class="modal fade" id="messModal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" style="color: #4E944F">Mess</h4>
            </div>
            <div class="modal-body" th:text="${mess}">
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{home-page :: footer}"></th:block>
</body>
<th:block th:replace="~{home-page :: js}"></th:block>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $("document").ready(function () {
        $("#messModal").modal("show");
    });

    function dataForEditForm(id) {
        let idVal = $("#customerId" + `${id}`).val();
        let nameVal = $("#customerName" + `${id}`).val();
        let dateOfBirthVal = $("#customerDateOfBirth" + `${id}`).val();
        let idCardVal = $("#customerIdCard" + `${id}`).val();
        let phoneNumberVal = $("#customerPhoneNumber" + `${id}`).val();
        let emailVal = $("#customerEmail" + `${id}`).val();
        let addressVal = $("#customerAddress" + `${id}`).val();
        let genderVal = $("#customerGender" + `${id}`).val();
        let customerTypeVal = $("#customerCustomerType" + `${id}`).val();
        console.log(idVal, nameVal, dateOfBirthVal, idCardVal, phoneNumberVal, emailVal, addressVal, genderVal, customerTypeVal)
        let customerObj = {
            id: idVal,
            name: nameVal,
            dateOfBirth: dateOfBirthVal,
            idCard: idCardVal,
            phoneNumber: phoneNumberVal,
            email: emailVal,
            address: addressVal,
            gender: {
                id: genderVal
            },
            customerType: {
                id: customerTypeVal
            }
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "PUT",
            url: "/api/customer/",
            data: JSON.stringify(customerObj),
            success: function (resultSuccess) {
                console.log(resultSuccess);
                alert("Edit success")
                location.reload();
            },
            error: function (resultError) {
                alert("Edit fail")
            }
        });
    }

</script>

</html>