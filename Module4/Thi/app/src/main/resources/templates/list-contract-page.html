<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <th:block th:fragment="css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
              crossorigin="anonymous">
    </th:block>
</head>
<body>
<th:block th:fragment="header">
    <header>
        <nav class="navbar navbar-expand-sm bg-success navbar-dark">
            <div class="container-fluid">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="/contract/list">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contract/list">Contract List</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="">Room List</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
</th:block>

<div style="color: #4e9a53; font-size: 60px; text-align: center;">
    LIST PAGE
</div>


<div th:text="${mess}" style="text-align: center; color: #051554; font-size: 35px" id="messConfirm">
</div>

<div style="overflow-x:auto ; margin-top: 50px; background-color: beige;
 border-radius: 20px; box-shadow:5px 5px 5px 5px #ADCF9F" class="container">


    <!--search-->
    <nav class="navbar justify-content-between container-fluid" style="margin-top: 20px">
        <div>
            <a href="/contract/addPage">
            <button class="btn btn-success">Add New</button>
            </a>
        </div>

        <div></div>

        <div>
            <form class="d-flex" action="/contract/list">
                <input class="form-control me-2" type="search" placeholder="Search" name="searchWord" th:value="${searchValue}">
                <button type="submit" class="btn btn-outline-success">Search</button>
            </form>
        </div>
    </nav>

    <!--table-->
    <table class="table table-bordered table-sm"
           style="color: #041C32 ; border-color: #CEE5D0;box-shadow: 5px 10px 18px #ADCF9F; white-space: nowrap">
        <tr style="background: #A3DA8D; color: #041C32">
            <th>Id contract</th>
            <th>Id room</th>
            <th>person name</th>
            <th>Contract date</th>
            <th>Time rent</th>
            <th>Total</th>
            <th>Delete</th>
        </tr>
        <tr th:each="contract :${contractPage}">
            <td th:text="${contract.nameContract}"></td>
            <td th:text="${contract.room.nameRoom}"></td>
            <td th:text="${contract.personName}"></td>
            <td th:text="${contract.dateRent}"></td>
            <td th:text="${contract.timeRent}"></td>
            <td id="totalCost">
                <input th:value="${contract.room.price}" th:id="'price'+${contract.id}">
                <input th:value="${contract.timeRent}" th:id="'time'+${contract.id}">
            </td>
            <td>
                <button class="btn btn-success btn-sm" data-bs-toggle="modal" th:data-bs-target="'#deleteModal'+${contract.id}">Delete</button>
                <!-- The Modal -->
                <div class="modal fade" th:id="'deleteModal'+${contract.id}">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">Delete</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                Are You Sure Delete?
                                <div>
                                     contract id = <span th:text="${contract.nameContract}"> </span>
                                </div>
                                <div>
                                    Room id = <span th:text="${contract.room.nameRoom}"></span>
                                </div>
                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-bs-dismiss="modal">No</button>
                                <button type="button" class="btn btn-danger" th:onclick="'deleteModel('+${contract.id}+')'">Yes</button>
                            </div>

                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </table>

    <!--paging-->
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-end">
            <li class="page-item">
                <a class="page-link" th:if="${contractPage.hasPrevious()}"
                   th:href="@{/contract/list(page=${contractPage.number - 1})}">Previous</a>
            </li>
            <li class="page-item"><a class="page-link" th:if="${contractPage.hasPrevious()}"
                                     th:href="@{/contract/list(page=${contractPage.number - 1})}"
                                     th:text="${contractPage.number}"></a></li>
            <li class="page-item"><span class="page-link" th:text="${contractPage.number + 1}"></span></li>
            <li class="page-item"><a class="page-link" th:if="${contractPage.hasNext()}"
                                     th:href="@{/contract/list(page=${contractPage.number + 1})}"
                                     th:text="${contractPage.number + 2}"></a></li>
            <li class="page-item">
                <a class="page-link" th:if="${contractPage.hasNext()}"
                   th:href="@{/contract/list(page=${contractPage.number + 1})}">Next</a>
            </li>
        </ul>
    </nav>
</div>


<th:block th:fragment="footer">
    <footer>
        <div style="margin-top: 500px" class="bg-dark">
            <div class="d-flex justify-content-center" style="height: 30px">
                <div class="p-2"><a href="#" style="color: #a8a2a2">Home</a></div>
                <div class="p-2"><a href="#" style="color: #a8a2a2">Features</a></div>
                <div class="p-2"><a href="#" style="color: #a8a2a2">Pricing</a></div>
                <div class="p-2"><a href="#" style="color: #a8a2a2">FAQs</a></div>
                <div class="p-2"><a href="#" style="color: #a8a2a2">About</a></div>
            </div>
            <div class="text-center text-muted">Â© 2021 Company, Inc</div>
        </div>
    </footer>
</th:block>



</body>
<th:block th:fragment="js">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</th:block>
<script>
    function deleteModel(id){
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "DELETE",
            url: "/api/contract/" + id,
            success: function(resultSuccess){
                console.log(resultSuccess);
                alert("delete success")
                location.reload();

            },
            error: function(resultError) {
                console.log("fail to delete");
                alert("delete fail")
            }
        });
    }

    $(document).ready(function (){
        let time = $("#time").val();
        console.log(time);
        let cost = $("#price").val();
        console.log(cost);
        $("#totalCost").html(time*cost);
    })

</script>
</html>